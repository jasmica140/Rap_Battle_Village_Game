#include "villagegame.h"

void mapcli(int playno, int totplay){

    for(int v=0; v<totplay; v++){
        map[village[playno].loc[0]][village[playno].loc[1]].status = "  V  ";
    }

    int acnt = village[playno].army;

    mvwprintw(win,10,122,"--MAP--");
    mvwprintw(win,10,151,"villages left: %d", totplay);
    wattron(win,COLOR_PAIR(2));

    int i,j,k,l;
    for(k=0; k<mapy; k++){
        for(i=0; i<mapx; i++){
            mvwprintw(win,11+(k*2),86+(i*6),"+-----");
        }
        mvwprintw(win,11+(k*2),86+(i*6),"+");

        for(i=0; i<mapy-2; i++){
            for(j=0; j<mapx; j++){
                mvwprintw(win,12+(k*2),86+(j*6), "|", map[j][k].status.c_str());

                wattron(win,COLOR_PAIR(3));

                //change color of current player's village
                if(j == village[playno].loc[0] && k == village[playno].loc[1]){
                    wattron(win, COLOR_PAIR(1));
                }

                //change color of current player's armies
                for(l=0; l<acnt; l++){
                    if(j == army[playno][acnt].loc[0] && k == army[playno][acnt].loc[1]) {
                        wattron(win, COLOR_PAIR(1));
                    }
                }

                mvwprintw(win,12+(k*2),87+(j*6), "%s", map[j][k].status.c_str());
                wattron(win,COLOR_PAIR(2));
            }
        }
        mvwprintw(win,12+(k*2),86+(j*6), "|");

    }

    for(i=0; i<mapx; i++){
        mvwprintw(win,11+(k*2),86+(i*6),"+-----");
    }
    mvwprintw(win,11+(k*2),86+(i*6),"+");
}

void villagecli(int playno){

    string vart;

    int vill = village[playno].rbuildings + village[playno].tbuildings;

    if(vill==0){
        vart = "                                                          |>>>\n"
               "                   _                                       |\n"
               "    ____________ .' '.                                    / \\\n"
               "   //// ////// /V_.-._\\                                  /___\\\n"
               "  // /// // ///==\\ u |.                                 .| u |_ _ _ _ _ _\n"
               " ///////-\\////====\\==|:::::::::::::::::::::::::::::::::::|u u| U U U U U\n"
               " |----/\\u |--|++++|..|'''''''''''::::::::::::::''''''''''|+++|+-+-+-+-+-+\n"
               " |u u|u | |u ||||||..|              '::::::::'           |===|>=== _ _ ==\n"
               " |===|  |u|==|++++|==|              .::::::::.           | T |....| V |..\n"
               " |u u|u | |u ||HH||         \\|/    .::::::::::.\n"
               " |===|_.|u|_.|+HH+|_              .::::::::::::.              _\n"
               "                __(_)___         .::::::::::::::.         ___(_)__\n"
               "---------------/  / \\  /|       .:::::;;;:::;;:::.       |\\  / \\  \\-------\n"
               "______________/_______/ |      .::::::;;:::::;;:::.      | \\_______\\________\n"
               "|       |     [===  =] /|     .:::::;;;::::::;;;:::.     |\\ [==  = ]   |\n"
               "|_______|_____[ = == ]/ |    .:::::;;;:::::::;;;::::.    | \\[ ===  ]___|____\n"
               "     |       |[  === ] /|   .:::::;;;::::::::;;;:::::.   |\\ [=  ===] |\n"
               "_____|_______|[== = =]/ |  .:::::;;;::::::::::;;;:::::.  | \\[ ==  =]_|______\n"
               " |       |    [ == = ] /| .::::::;;:::::::::::;;;::::::. |\\ [== == ]      |\n"
               "_|_______|____[=  == ]/ |.::::::;;:::::::::::::;;;::::::.| \\[  === ]______|_\n"
               "   |       |  [ === =] /.::::::;;::::::::::::::;;;:::::::.\\ [===  =]   |\n"
               "___|_______|__[ == ==]/.::::::;;;:::::::::::::::;;;:::::::.\\[=  == ]___|_____";

    }else if(vill==1){
        vart = "                                                          |>>>\n"
               "                   _                                       |\n"
               "    ____________ .' '.                       /========\\   / \\\n"
               "   //// ////// /V_.-._\\                      | u    u |  /___\\\n"
               "  // /// // ///==\\ u |.                      |   ||   | .| u |_ _ _ _ _ _\n"
               " ///////-\\////====\\==|:::::::::::::::::::::::::::::::::::|u u| U U U U U\n"
               " |----/\\u |--|++++|..|'''''''''''::::::::::::::''''''''''|+++|+-+-+-+-+-+\n"
               " |u u|u | |u ||||||..|              '::::::::'           |===|>=== _ _ ==\n"
               " |===|  |u|==|++++|==|              .::::::::.           | T |....| V |..\n"
               " |u u|u | |u ||HH||         \\|/    .::::::::::.\n"
               " |===|_.|u|_.|+HH+|_              .::::::::::::.              _\n"
               "                __(_)___         .::::::::::::::.         ___(_)__\n"
               "---------------/  / \\  /|       .:::::;;;:::;;:::.       |\\  / \\  \\-------\n"
               "______________/_______/ |      .::::::;;:::::;;:::.      | \\_______\\________\n"
               "|       |     [===  =] /|     .:::::;;;::::::;;;:::.     |\\ [==  = ]   |\n"
               "|_______|_____[ = == ]/ |    .:::::;;;:::::::;;;::::.    | \\[ ===  ]___|____\n"
               "     |       |[  === ] /|   .:::::;;;::::::::;;;:::::.   |\\ [=  ===] |\n"
               "_____|_______|[== = =]/ |  .:::::;;;::::::::::;;;:::::.  | \\[ ==  =]_|______\n"
               " |       |    [ == = ] /| .::::::;;:::::::::::;;;::::::. |\\ [== == ]      |\n"
               "_|_______|____[=  == ]/ |.::::::;;:::::::::::::;;;::::::.| \\[  === ]______|_\n"
               "   |       |  [ === =] /.::::::;;::::::::::::::;;;:::::::.\\ [===  =]   |\n"
               "___|_______|__[ == ==]/.::::::;;;:::::::::::::::;;;:::::::.\\[=  == ]___|_____";

    }else if(vill==2){

        vart = "                                                          |>>>\n"
               "                   _                      _                |\n"
               "    ____________ .' '.                  .' './========\\   / \\\n"
               "   //// ////// /V_.-._\\                |-----| u    u |  /___\\\n"
               "  // /// // ///==\\ u |.                | |T| |   ||   | .| u |_ _ _ _ _ _\n"
               " ///////-\\////====\\==|:::::::::::::::::::::::::::::::::::|u u| U U U U U\n"
               " |----/\\u |--|++++|..|'''''''''''::::::::::::::''''''''''|+++|+-+-+-+-+-+\n"
               " |u u|u | |u ||||||..|              '::::::::'           |===|>=== _ _ ==\n"
               " |===|  |u|==|++++|==|              .::::::::.           | T |....| V |..\n"
               " |u u|u | |u ||HH||         \\|/    .::::::::::.\n"
               " |===|_.|u|_.|+HH+|_              .::::::::::::.              _\n"
               "                __(_)___         .::::::::::::::.         ___(_)__\n"
               "---------------/  / \\  /|       .:::::;;;:::;;:::.       |\\  / \\  \\-------\n"
               "______________/_______/ |      .::::::;;:::::;;:::.      | \\_______\\________\n"
               "|       |     [===  =] /|     .:::::;;;::::::;;;:::.     |\\ [==  = ]   |\n"
               "|_______|_____[ = == ]/ |    .:::::;;;:::::::;;;::::.    | \\[ ===  ]___|____\n"
               "     |       |[  === ] /|   .:::::;;;::::::::;;;:::::.   |\\ [=  ===] |\n"
               "_____|_______|[== = =]/ |  .:::::;;;::::::::::;;;:::::.  | \\[ ==  =]_|______\n"
               " |       |    [ == = ] /| .::::::;;:::::::::::;;;::::::. |\\ [== == ]      |\n"
               "_|_______|____[=  == ]/ |.::::::;;:::::::::::::;;;::::::.| \\[  === ]______|_\n"
               "   |       |  [ === =] /.::::::;;::::::::::::::;;;:::::::.\\ [===  =]   |\n"
               "___|_______|__[ == ==]/.::::::;;;:::::::::::::::;;;:::::::.\\[=  == ]___|_____";

    }else if(vill==3){

        vart = "                                                          |>>>\n"
               "                   _                      _                |\n"
               "    ____________ .' '.              /-\\ .' './========\\   / \\\n"
               "   //// ////// /V_.-._\\            | _ |-----| u    u |  /___\\\n"
               "  // /// // ///==\\ u |.            ||||| |T| |   ||   | .| u |_ _ _ _ _ _\n"
               " ///////-\\////====\\==|:::::::::::::::::::::::::::::::::::|u u| U U U U U\n"
               " |----/\\u |--|++++|..|'''''''''''::::::::::::::''''''''''|+++|+-+-+-+-+-+\n"
               " |u u|u | |u ||||||..|              '::::::::'           |===|>=== _ _ ==\n"
               " |===|  |u|==|++++|==|              .::::::::.           | T |....| V |..\n"
               " |u u|u | |u ||HH||         \\|/    .::::::::::.\n"
               " |===|_.|u|_.|+HH+|_              .::::::::::::.              _\n"
               "                __(_)___         .::::::::::::::.         ___(_)__\n"
               "---------------/  / \\  /|       .:::::;;;:::;;:::.       |\\  / \\  \\-------\n"
               "______________/_______/ |      .::::::;;:::::;;:::.      | \\_______\\________\n"
               "|       |     [===  =] /|     .:::::;;;::::::;;;:::.     |\\ [==  = ]   |\n"
               "|_______|_____[ = == ]/ |    .:::::;;;:::::::;;;::::.    | \\[ ===  ]___|____\n"
               "     |       |[  === ] /|   .:::::;;;::::::::;;;:::::.   |\\ [=  ===] |\n"
               "_____|_______|[== = =]/ |  .:::::;;;::::::::::;;;:::::.  | \\[ ==  =]_|______\n"
               " |       |    [ == = ] /| .::::::;;:::::::::::;;;::::::. |\\ [== == ]      |\n"
               "_|_______|____[=  == ]/ |.::::::;;:::::::::::::;;;::::::.| \\[  === ]______|_\n"
               "   |       |  [ === =] /.::::::;;::::::::::::::;;;:::::::.\\ [===  =]   |\n"
               "___|_______|__[ == ==]/.::::::;;;:::::::::::::::;;;:::::::.\\[=  == ]___|_____";

    } else if(vill==4){
        vart = "                                                          |>>>\n"
               "                   _                      _                |\n"
               "    ____________ .' '.         /----/-\\ .' './========\\   / \\\n"
               "   //// ////// /V_.-._\\        |===| _ |-----| u    u |  /___\\\n"
               "  // /// // ///==\\ u |.        |===||||| |T| |   ||   | .| u |_ _ _ _ _ _\n"
               " ///////-\\////====\\==|:::::::::::::::::::::::::::::::::::|u u| U U U U U\n"
               " |----/\\u |--|++++|..|'''''''''''::::::::::::::''''''''''|+++|+-+-+-+-+-+\n"
               " |u u|u | |u ||||||..|              '::::::::'           |===|>=== _ _ ==\n"
               " |===|  |u|==|++++|==|              .::::::::.           | T |....| V |..\n"
               " |u u|u | |u ||HH||         \\|/    .::::::::::.\n"
               " |===|_.|u|_.|+HH+|_              .::::::::::::.              _\n"
               "                __(_)___         .::::::::::::::.         ___(_)__\n"
               "---------------/  / \\  /|       .:::::;;;:::;;:::.       |\\  / \\  \\-------\n"
               "______________/_______/ |      .::::::;;:::::;;:::.      | \\_______\\________\n"
               "|       |     [===  =] /|     .:::::;;;::::::;;;:::.     |\\ [==  = ]   |\n"
               "|_______|_____[ = == ]/ |    .:::::;;;:::::::;;;::::.    | \\[ ===  ]___|____\n"
               "     |       |[  === ] /|   .:::::;;;::::::::;;;:::::.   |\\ [=  ===] |\n"
               "_____|_______|[== = =]/ |  .:::::;;;::::::::::;;;:::::.  | \\[ ==  =]_|______\n"
               " |       |    [ == = ] /| .::::::;;:::::::::::;;;::::::. |\\ [== == ]      |\n"
               "_|_______|____[=  == ]/ |.::::::;;:::::::::::::;;;::::::.| \\[  === ]______|_\n"
               "   |       |  [ === =] /.::::::;;::::::::::::::;;;:::::::.\\ [===  =]   |\n"
               "___|_______|__[ == ==]/.::::::;;;:::::::::::::::;;;:::::::.\\[=  == ]___|_____";
    } else if(vill>=5){

        vart = "                                                          |>>>\n"
               "                   _                      _                |\n"
               "    ____________ .' '.    _____/----/-\\ .' './========\\   / \\\n"
               "   //// ////// /V_.-._\\  |.-.-.|===| _ |-----| u    u |  /___\\\n"
               "  // /// // ///==\\ u |.  || | ||===||||| |T| |   ||   | .| u |_ _ _ _ _ _\n"
               " ///////-\\////====\\==|:::::::::::::::::::::::::::::::::::|u u| U U U U U\n"
               " |----/\\u |--|++++|..|'''''''''''::::::::::::::''''''''''|+++|+-+-+-+-+-+\n"
               " |u u|u | |u ||||||..|              '::::::::'           |===|>=== _ _ ==\n"
               " |===|  |u|==|++++|==|              .::::::::.           | T |....| V |..\n"
               " |u u|u | |u ||HH||         \\|/    .::::::::::.\n"
               " |===|_.|u|_.|+HH+|_              .::::::::::::.              _\n"
               "                __(_)___         .::::::::::::::.         ___(_)__\n"
               "---------------/  / \\  /|       .:::::;;;:::;;:::.       |\\  / \\  \\-------\n"
               "______________/_______/ |      .::::::;;:::::;;:::.      | \\_______\\________\n"
               "|       |     [===  =] /|     .:::::;;;::::::;;;:::.     |\\ [==  = ]   |\n"
               "|_______|_____[ = == ]/ |    .:::::;;;:::::::;;;::::.    | \\[ ===  ]___|____\n"
               "     |       |[  === ] /|   .:::::;;;::::::::;;;:::::.   |\\ [=  ===] |\n"
               "_____|_______|[== = =]/ |  .:::::;;;::::::::::;;;:::::.  | \\[ ==  =]_|______\n"
               " |       |    [ == = ] /| .::::::;;:::::::::::;;;::::::. |\\ [== == ]      |\n"
               "_|_______|____[=  == ]/ |.::::::;;:::::::::::::;;;::::::.| \\[  === ]______|_\n"
               "   |       |  [ === =] /.::::::;;::::::::::::::;;;:::::::.\\ [===  =]   |\n"
               "___|_______|__[ == ==]/.::::::;;;:::::::::::::::;;;:::::::.\\[=  == ]___|_____";
    }

    //count troops in armies
    int atrps=0;
    for(int i=0; i<village[playno].army; i++){
        atrps+=army[playno][i].troops;
    }
    //count troops
    int k=0,l=0,m=0,n=0;
    for(int i=0; i<village[playno].troops; i++){
        if(troops[playno][i].type=="untrained"){
            k++;
        }else if(troops[playno][i].type=="rookie"){
            l++;
        }else if(troops[playno][i].type=="expert"){
            m++;
        }else if(troops[playno][i].type=="master"){
            n++;
        }
    }

    wattron(win,COLOR_PAIR(4));
    mvwprintw(win,1,1,"%s",vart.c_str());

    wattron(win,COLOR_PAIR(3));
    mvwprintw(win,1,86,"Player %d's Village:",playno+1);
    mvwprintw(win,2,86,"Village health: %d",village[playno].health);
    mvwprintw(win,3,86,"Troops: %d",village[playno].troops);
    mvwprintw(win,4,86,"Armies: %d",village[playno].army);
    mvwprintw(win,5,86,"Resource-generating buildings: %d",village[playno].rbuildings);
    mvwprintw(win,6,86,"Troop-training buildings: %d",village[playno].tbuildings);


    mvwprintw(win,1,121,"Resources: ");
    mvwprintw(win,2,121,"Tools: %d ",resource[playno][0].amount);
    mvwprintw(win,3,121,"Food: %d ",resource[playno][1].amount);
    mvwprintw(win,4,121,"Money: %d ",resource[playno][2].amount);


    mvwprintw(win,1,136,"Stationed Troops: ");
    mvwprintw(win,2,136,"Untrained: %d ",k-atrps);
    mvwprintw(win,3,136,"Rookies: %d ",l);
    mvwprintw(win,4,136,"Experts: %d ",m);
    mvwprintw(win,5,136,"Masters: %d ",n);
}

int alertcli(int playno, int totplay, string type){

    if(!village[playno].preal){
        return 1;
    }

    wclear(win);
    wrefresh(win);

    wattron(win,COLOR_PAIR(1));
    mvwhline(win, 13, 65, '*', 40);
    mvwhline(win, 17, 65, '*', 40);
    mvwvline(win, 13, 65, '*', 4);
    mvwvline(win, 13, 105,'*', 5);

    int x = 25;
    int y = 8;

    wattron(win,COLOR_PAIR(2));
    mvwprintw(win,y,x,"  ,   |           ");
    mvwprintw(win,y+1,x," / \\, | ,        .--.");
    mvwprintw(win,y+2,x,"|    =|= >      /.--.\\");
    mvwprintw(win,y+3,x," \\ /` | `       |====|");
    mvwprintw(win,y+4,x,"  `   |         |`::`|");
    mvwprintw(win,y+5,x,"      |     .-;`\\..../`;_.-^-._");
    mvwprintw(win,y+6,x,"     /\\/  /  |...::..|`   :   `|");
    mvwprintw(win,y+7,x,"     |:'\\ |   /'''::''|   .:.   |");
    mvwprintw(win,y+8,x,"      \\ /\\;-,/\\   ::  |..:::::..|");
    mvwprintw(win,y+9,x,"      |\\ <` >  >._::_.| ':::::' |");
    mvwprintw(win,y+10,x,"      | `\"\"`  /   ^^  |   ':'   |");
    mvwprintw(win,y+11,x,"      |       |       \\    :    /");
    mvwprintw(win,y+12,x,"      |       |        \\   :   /");
    mvwprintw(win,y+13,x,"      |       |___/\\___|`-.:.-`");
    mvwprintw(win,y+14,x,"      |        \\_ || _/    `");
    mvwprintw(win,y+15,x,"      |        <_ >< _>");
    mvwprintw(win,y+16,x,"      |        |  ||  |");
    mvwprintw(win,y+17,x,"      |        |  ||  |");
    mvwprintw(win,y+18,x,"      |       _\\.:||:./_");
    mvwprintw(win,y+19,x,"      |      /____/\\____\\");

    x = 110;
    mvwprintw(win,y,x,"  ,   |           ");
    mvwprintw(win,y+1,x," / \\, | ,        .--.");
    mvwprintw(win,y+2,x,"|    =|= >      /.--.\\");
    mvwprintw(win,y+3,x," \\ /` | `       |====|");
    mvwprintw(win,y+4,x,"  `   |         |`::`|");
    mvwprintw(win,y+5,x,"      |     .-;`\\..../`;_.-^-._");
    mvwprintw(win,y+6,x,"     /\\/  /  |...::..|`   :   `|");
    mvwprintw(win,y+7,x,"     |:'\\ |   /'''::''|   .:.   |");
    mvwprintw(win,y+8,x,"      \\ /\\;-,/\\   ::  |..:::::..|");
    mvwprintw(win,y+9,x,"      |\\ <` >  >._::_.| ':::::' |");
    mvwprintw(win,y+10,x,"      | `\"\"`  /   ^^  |   ':'   |");
    mvwprintw(win,y+11,x,"      |       |       \\    :    /");
    mvwprintw(win,y+12,x,"      |       |        \\   :   /");
    mvwprintw(win,y+13,x,"      |       |___/\\___|`-.:.-`");
    mvwprintw(win,y+14,x,"      |        \\_ || _/    `");
    mvwprintw(win,y+15,x,"      |        <_ >< _>");
    mvwprintw(win,y+16,x,"      |        |  ||  |");
    mvwprintw(win,y+17,x,"      |        |  ||  |");
    mvwprintw(win,y+18,x,"      |       _\\.:||:./_");
    mvwprintw(win,y+19,x,"      |      /____/\\____\\");


    if(type=="attack"){
        mvwprintw(win,15,73,"VILLAGE UNDER ATTACK!");

    }else if(type == "success"){
        mvwprintw(win,15,78,"ATTACK SUCCESSFUL!");

    }else if(type == "fail"){
        mvwprintw(win,15,76,"ATTACK FAILED!");

    }else if(type == "destroy"){
        mvwprintw(win,15,76,"VILLAGE DESTROYED!");

    }else if(type == "round"){
        mvwprintw(win,15,83,"NEXT ROUND");
    }

    int choice = wgetch(win);
    if (choice == 10) {
        refreshcli(playno,totplay);
        return 0;
    }

    return 0;
}

void refreshcli(int playno, int totplay){
    wclear(win);
    wrefresh(win);
    villagecli(playno);
    mvwprintw(win,1,1,"Player %d's turn!",playno+1);
    mapcli(playno,totplay);
    wattron(win,COLOR_PAIR(1));
    mvwhline(win, 24, 1, '_', 80);
    mvwhline(win, 8, 80, '_', 100);
    mvwvline(win, 1, 80, '|', 37);
    mvwhline(win, 36, 1, '_', 79);
    wattron(win,COLOR_PAIR(3));
}
